name: User Suggestion Pipeline

on:
  issues:
    types: [opened]
  workflow_dispatch:

permissions:
  issues: write
  pull-requests: write

jobs:
  process-suggestion:
    name: Process User Suggestion
    runs-on: ubuntu-latest
    if: contains(github.event.issue.labels.*.name, 'suggestion')
    steps:
      - name: Analyze and route suggestion
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const text = (issue.title + ' ' + issue.body).toLowerCase();
            
            // Determine category
            let category = 'general';
            if (text.includes('ui') || text.includes('design')) category = 'ui-ux';
            else if (text.includes('performance')) category = 'performance';
            else if (text.includes('feature')) category = 'feature';
            else if (text.includes('bug')) category = 'bug';
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              body: `Thank you for your suggestion! ðŸŒŸ
              
              Category: **${category}**
              
              We'll review this and get back to you within 48 hours!
              
              ---
              ðŸ¤– Suggestion Pipeline`
            });
            
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              labels: [category, 'community-suggestion']
            }).catch(() => {});
