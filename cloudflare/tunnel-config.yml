# BlackRoad OS Cloudflare Tunnel Configuration
# Updated for Railway deployment
#
# This tunnel runs on the Raspberry Pi (blackroad-pi) and routes traffic to:
# 1. Local network services (10.0.1.0/24)
# 2. Railway-hosted services (via public URLs)
#
# SETUP:
# 1. SSH to Pi: ssh pi@<pi-ip>
# 2. Copy this file to ~/.cloudflared/config.yml
# 3. Restart: sudo systemctl restart cloudflared

tunnel: blackroad-pi
credentials-file: /home/pi/.cloudflared/52915859-da18-4aa6-add5-7bd9fcac2e0b.json

# Warp routing for private network access
warp-routing:
  enabled: true

ingress:
  # ============================================
  # LOCAL SERVICES (via Pi on 10.0.1.0/24)
  # ============================================

  # Pi Operator (local)
  - hostname: operator.blackroad.local
    service: http://localhost:8080
    originRequest:
      noTLSVerify: true

  # Local devices on home network accessible via WARP
  # Use IP routes instead of hostname routes for these

  # ============================================
  # RAILWAY SERVICES (proxied through tunnel)
  # ============================================

  # Operator Engine
  - hostname: operator.blackroad.io
    service: https://blackroad-os-operator-production.up.railway.app
    originRequest:
      noTLSVerify: true

  # Prism Console
  - hostname: prism.blackroad.io
    service: https://blackroad-os-prism-console-production.up.railway.app
    originRequest:
      noTLSVerify: true

  # Documentation
  - hostname: docs.blackroad.io
    service: https://docs.blackroad.io
    originRequest:
      noTLSVerify: true

  # ============================================
  # CLOUDFLARE PAGES (already public, just alias)
  # ============================================

  # Main web
  - hostname: web.blackroad.io
    service: https://blackroad-os-web.pages.dev
    originRequest:
      noTLSVerify: true

  # Brand assets
  - hostname: brand.blackroad.io
    service: https://blackroad-os-brand.pages.dev
    originRequest:
      noTLSVerify: true

  # Demo
  - hostname: demo.blackroad.io
    service: https://blackroad-os-demo.pages.dev
    originRequest:
      noTLSVerify: true

  # ============================================
  # CATCH-ALL
  # ============================================
  - service: http_status:404
